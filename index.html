<!DOCTYPE html>
<html>
<head>
  <title>Blockchain Product Registry</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f3f3f3; }
    input, button { padding: 10px; margin: 5px 0; width: 100%; }
    .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
    h2 { text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Register Product</h2>
    <input type="text" id="productId" placeholder="Product ID" />
    <input type="text" id="name" placeholder="Product Name" />
    <input type="text" id="manufacturer" placeholder="Manufacturer" />
    <input type="number" id="mDate" placeholder="Manufacture Date (UNIX timestamp)" />
    <button onclick="registerProduct()">Register</button>

    <h2>Verify Product</h2>
    <input type="text" id="verifyId" placeholder="Product ID to Verify" />
    <button onclick="verifyProduct()">Verify</button>

    <pre id="output"></pre>
  </div>

  <script>
    // ✅ Copy these from Remix after deployment
    const contractAddress = "YOUR_DEPLOYED_CONTRACT_ADDRESS_HERE";

    const contractABI = [
      {
        "anonymous": false,
        "inputs": [
          { "indexed": false, "internalType": "string", "name": "productId", "type": "string" },
          { "indexed": false, "internalType": "string", "name": "name", "type": "string" },
          { "indexed": false, "internalType": "string", "name": "manufacturer", "type": "string" }
        ],
        "name": "ProductRegistered",
        "type": "event"
      },
      {
        "inputs": [
          { "internalType": "string", "name": "productId", "type": "string" },
          { "internalType": "string", "name": "name", "type": "string" },
          { "internalType": "string", "name": "manufacturer", "type": "string" },
          { "internalType": "uint256", "name": "mDate", "type": "uint256" }
        ],
        "name": "registerProduct",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "string", "name": "productId", "type": "string" }
        ],
        "name": "verifyProduct",
        "outputs": [
          { "internalType": "bool", "name": "exists", "type": "bool" },
          { "internalType": "string", "name": "name", "type": "string" },
          { "internalType": "string", "name": "manufacturer", "type": "string" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    let contractInstance;

    async function getContractInstance() {
      // Use Remix VM — manually assign web3 (via Remix’s JSVM console or load here if needed)
      if (typeof web3 === 'undefined') {
        alert('Please open this in Remix HTML preview or add web3 support.');
        return;
      }

      const Contract = new web3.eth.Contract(contractABI, contractAddress);
      contractInstance = Contract;

      const accounts = await web3.eth.getAccounts();
      return accounts[0];
    }

    async function registerProduct() {
      const account = await getContractInstance();
      const id = document.getElementById('productId').value;
      const name = document.getElementById('name').value;
      const mfg = document.getElementById('manufacturer').value;
      const date = document.getElementById('mDate').value;

      try {
        await contractInstance.methods.registerProduct(id, name, mfg, date).send({ from: account });
        document.getElementById('output').textContent = "✅ Product Registered!";
      } catch (err) {
        document.getElementById('output').textContent = "❌ Error: " + err.message;
      }
    }

    async function verifyProduct() {
      const id = document.getElementById('verifyId').value;
      try {
        const result = await contractInstance.methods.verifyProduct(id).call();
        if (result.exists) {
          document.getElementById('output').textContent = `✅ Product Found\nName: ${result.name}\nManufacturer: ${result.manufacturer}`;
        } else {
          document.getElementById('output').textContent = "❌ Product not found!";
        }
      } catch (err) {
        document.getElementById('output').textContent = "❌ Error: " + err.message;
      }
    }
  </script>
</body>
</html>
