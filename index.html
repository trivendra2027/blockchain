<!-- Keep your original <head> section as-is -->
<!-- Start of <body> -->
<body>

  <h1>Blockchain Product System</h1>
  <button id="connectWalletBtn">üîó Connect Wallet</button>
  <p id="walletAddress"></p>

  <!-- üîí Product Registration Section -->
  <section>
    <h2>Register Product</h2>
    <input type="text" id="reg-productId" placeholder="Product ID" />
    <input type="text" id="reg-name" placeholder="Product Name" />
    <input type="text" id="reg-manufacturer" placeholder="Manufacturer" />
    <button id="register-btn" disabled>Register Product</button>
    <p id="register-status"></p>
  </section>

  <!-- ‚úÖ Product Verification Section -->
  <section>
    <h2>Verify Product</h2>
    <input type="text" id="verify-productId" placeholder="Scan or enter product ID" autocomplete="off" />
    <button id="verify-btn" disabled>Verify Product</button>
    <div id="verification-result"></div>
    <div id="qr-reader"></div>
  </section>

  <!-- üë§ Ownership Verification Section -->
  <section>
    <h2>Check Product Owner</h2>
    <input type="text" id="owner-productId" placeholder="Enter Product ID" />
    <button id="owner-btn" disabled>Get Owner</button>
    <p id="owner-result"></p>
  </section>

  <script>
    const contractABI = [/* paste your full ABI here */];
    const contractAddress = "0x..."; // paste your contract address

    let web3, contract, userAccount;

    const verifyInput = document.getElementById('verify-productId');
    const verifyBtn = document.getElementById('verify-btn');
    const registerBtn = document.getElementById('register-btn');
    const ownerBtn = document.getElementById('owner-btn');

    // Connect wallet
    document.getElementById("connectWalletBtn").addEventListener("click", async () => {
      if (typeof window.ethereum !== 'undefined') {
        try {
          web3 = new Web3(window.ethereum);
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
          userAccount = accounts[0];
          document.getElementById("walletAddress").innerText = "Connected: " + userAccount;
          contract = new web3.eth.Contract(contractABI, contractAddress);

          registerBtn.disabled = false;
          verifyBtn.disabled = false;
          ownerBtn.disabled = false;
        } catch (err) {
          alert("Connection rejected.");
        }
      } else {
        alert("Install MetaMask.");
      }
    });

    // Register product
    registerBtn.addEventListener('click', async () => {
      const id = document.getElementById('reg-productId').value;
      const name = document.getElementById('reg-name').value;
      const maker = document.getElementById('reg-manufacturer').value;
      const timestamp = Math.floor(Date.now() / 1000);
      document.getElementById('register-status').textContent = "‚è≥ Registering...";
      try {
        await contract.methods.registerProduct(id, name, maker, timestamp).send({ from: userAccount });
        document.getElementById('register-status').textContent = "‚úÖ Registered successfully.";
      } catch (err) {
        document.getElementById('register-status').textContent = "‚ùå Registration failed.";
      }
    });

    // Verify product
    verifyBtn.addEventListener('click', async () => {
      const productId = verifyInput.value.trim();
      const resultDiv = document.getElementById('verification-result');
      resultDiv.textContent = "";
      resultDiv.className = "";
      if (!productId) return alert("Enter or scan product ID.");

      try {
        const result = await contract.methods.verifyProduct(productId).call({ from: userAccount });
        if (result[0]) {
          resultDiv.innerHTML = `<strong>‚úîÔ∏è Authentic</strong><br>Name: ${result[1]}<br>Manufacturer: ${result[2]}`;
          resultDiv.className = "success";
        } else {
          resultDiv.textContent = "‚ùå Product not found.";
          resultDiv.className = "error";
        }
      } catch {
        resultDiv.textContent = "‚ö†Ô∏è Verification error.";
        resultDiv.className = "error";
      }
    });

    // Get product owner
    ownerBtn.addEventListener('click', async () => {
      const pid = document.getElementById('owner-productId').value.trim();
      const res = document.getElementById('owner-result');
      if (!pid) return;
      res.textContent = "‚è≥ Checking owner...";
      try {
        const owner = await contract.methods.getProductOwner(pid).call();
        res.textContent = `üë§ Owner: ${owner}`;
      } catch {
        res.textContent = "‚ùå Failed to fetch owner.";
      }
    });

    // QR Scanner Setup
    const qrCodeRegionId = "qr-reader";
    const html5QrCode = new Html5Qrcode(qrCodeRegionId);

    function onScanSuccess(decodedText) {
      verifyInput.value = decodedText;
    }

    Html5Qrcode.getCameras().then(cameras => {
      if (cameras && cameras.length) {
        html5QrCode.start(
          cameras[0].id,
          { fps: 10, qrbox: 250 },
          onScanSuccess,
          () => {}
        );
      }
    });
  </script>

</body>
