<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Blockchain Product Registry</title>
  <style>
    body { font-family: Arial; margin: 30px; }
    label, input, button { display: block; margin: 10px 0; }
    #result { margin-top: 20px; }
  </style>
</head>
<body>

  <h2>Register Product</h2>
  <label>Product ID</label>
  <input type="text" id="productId">
  <label>Name</label>
  <input type="text" id="name">
  <label>Manufacturer</label>
  <input type="text" id="manufacturer">
  <label>Manufacture Date (UNIX Timestamp)</label>
  <input type="number" id="mDate">
  <button onclick="registerProduct()">Register Product</button>

  <hr>

  <h2>Verify Product</h2>
  <label>Enter Product ID</label>
  <input type="text" id="verifyProductId">
  <button onclick="verifyProduct()">Verify</button>

  <div id="result"></div>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script>
    // Your contract address and ABI
    const contractAddress = "0xD7ACd2a9FD159E69Bb102A1ca21C9a3e3A5F771B";
    const contractABI = [
      {
        "anonymous": false,
        "inputs": [
          { "indexed": false, "internalType": "string", "name": "productId", "type": "string" },
          { "indexed": false, "internalType": "string", "name": "name", "type": "string" },
          { "indexed": false, "internalType": "string", "name": "manufacturer", "type": "string" }
        ],
        "name": "ProductRegistered",
        "type": "event"
      },
      {
        "inputs": [
          { "internalType": "string", "name": "productId", "type": "string" },
          { "internalType": "string", "name": "name", "type": "string" },
          { "internalType": "string", "name": "manufacturer", "type": "string" },
          { "internalType": "uint256", "name": "mDate", "type": "uint256" }
        ],
        "name": "registerProduct",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "string", "name": "productId", "type": "string" }
        ],
        "name": "verifyProduct",
        "outputs": [
          { "internalType": "bool", "name": "exists", "type": "bool" },
          { "internalType": "string", "name": "name", "type": "string" },
          { "internalType": "string", "name": "manufacturer", "type": "string" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    // Setup Web3
    if (typeof window.ethereum !== 'undefined') {
      window.web3 = new Web3(window.ethereum);
      window.ethereum.request({ method: 'eth_requestAccounts' });
    } else {
      alert("Please install MetaMask or use Remix VM with injected Web3.");
    }

    const contract = new web3.eth.Contract(contractABI, contractAddress);

    async function registerProduct() {
      const productId = document.getElementById("productId").value;
      const name = document.getElementById("name").value;
      const manufacturer = document.getElementById("manufacturer").value;
      const mDate = document.getElementById("mDate").value;
      const accounts = await web3.eth.getAccounts();

      contract.methods.registerProduct(productId, name, manufacturer, mDate)
        .send({ from: accounts[0] })
        .then(() => alert("✅ Product Registered!"))
        .catch(err => alert("❌ Error: " + err.message));
    }

    async function verifyProduct() {
      const productId = document.getElementById("verifyProductId").value;

      contract.methods.verifyProduct(productId).call()
        .then(result => {
          if (result.exists) {
            document.getElementById("result").innerHTML = `
              ✅ <strong>Product Found:</strong><br>
              Name: ${result.name}<br>
              Manufacturer: ${result.manufacturer}
            `;
          } else {
            document.getElementById("result").innerText = "❌ Product not found.";
          }
        })
        .catch(err => document.getElementById("result").innerText = "❌ Error: " + err.message);
    }
  </script>

</body>
</html>
